<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ö–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link href="https://fonts.googleapis.com/css?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32'><circle cx='16' cy='16' r='16' fill='%2349b87a'/><text x='50%' y='54%' text-anchor='middle' fill='white' font-size='17' font-family='Arial' dy='.3em'>üé°</text></svg>">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
</head>
<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã -->
<div id="referral-modal" class="modal-bg" style="display:none;">
  <div class="modal-content">
    <h3 style="margin-top:0;color:#ba8cff;">–ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–∑–µ–π</h3>
    <div class="referral-stats">
      <div class="stat-item">
        <div class="stat-value" id="ref-invited">0</div>
        <div class="stat-label">–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="ref-earned">0 TON</div>
        <div class="stat-label">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
      </div>
    </div>
    <div class="referral-link">
      <input type="text" id="ref-link" readonly>
      <button class="btn small" onclick="copyRefLink()">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
    </div>
    <p style="font-size:14px;color:#888;margin:15px 0;">
      –ü–æ–ª—É—á–∞–π 5% –æ—Ç –≤—Å–µ—Ö —Å—Ç–∞–≤–æ–∫ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã—Ö –¥—Ä—É–∑–µ–π!
    </p>
    <button class="btn" onclick="shareRefLink()">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
    <button class="btn danger" onclick="document.getElementById('referral-modal').style.display='none'" style="margin-top:10px;">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>
<body>
  <!-- –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–æ–±–µ–¥–µ -->
  <div id="winner-popup" style="display:none;">
    <div class="winner-popup-inner">
      <div id="winner-popup-nick"></div>
      <div id="winner-popup-gifts"></div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ "–ù–µ—Ç –ø–æ–¥–∞—Ä–∫–æ–≤" -->
  <div id="no-gifts-modal" class="modal-bg" style="display:none;">
    <div class="modal-content">
      <div class="plane-anim">
        <svg width="60" height="60" viewBox="0 0 48 48" fill="none">
          <polygon points="2,24 46,6 38,42 24,32 10,36" fill="#fff" stroke="#3e8ed0" stroke-width="2"/>
          <polyline points="2,24 24,32 46,6" fill="none" stroke="#3e8ed0" stroke-width="2"/>
        </svg>
      </div>
      <div class="modal-text">
        –ü–æ–¥–∞—Ä–∫–æ–≤ –ø–æ–∫–∞ —á—Ç–æ –Ω–µ—Ç—É....<br>
        –ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫, –æ—Ç–ø—Ä–∞–≤—å –µ–≥–æ –±–æ—Ç—É<br>
        <b>@GIFTBOTRELAYER</b>
      </div>
      <button class="btn" id="closeNoGiftsModal">–ü–æ–Ω—è—Ç–Ω–æ</button>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –ø–æ–¥–∞—Ä–∫–∞ -->
  <div id="choose-gift-modal" class="modal-bg" style="display:none;">
    <div class="modal-content">
      <div class="modal-text" style="font-size:18px;">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∞—Ä–æ–∫ –¥–ª—è —É—á–∞—Å—Ç–∏—è:</div>
      <div id="choose-gift-list" style="margin:18px 0;"></div>
      <div class="quick-bets">
        <button class="quick-ton-btn" data-amount="0.5">0.5 TON</button>
        <button class="quick-ton-btn" data-amount="1">1 TON</button>
        <button class="quick-ton-btn" data-amount="2">2 TON</button>
      </div>
      <button class="btn" id="chooseGiftConfirmBtn" disabled>–ü–æ—Å—Ç–∞–≤–∏—Ç—å</button>
      <button class="btn danger" id="closeChooseGiftModal" style="margin-top:6px;">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
  <div class="container">
    <!-- –ë–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram -->
    <div id="tg-user-bar" style="display:none; padding:10px; background:#2a243d; margin-bottom:10px; border-radius:12px;"></div>
    
    <div id="tab-content">
      <!-- Bee Tab -->
      <div id="bee" class="tab" style="display:none;">
        <div id="bee-info-block-cards"></div>
        <h2 style="text-align:center;">–†–æ–π –ü—á—ë–ª üêù</h2>
        <div id="bee-bank"></div>
        <canvas id="bee-canvas"></canvas>
        <div id="bee-timer"></div>
        <div class="btn-group">
          <button class="btn" id="bee-addGiftsBtn">–í–Ω–µ—Å—Ç–∏ –ü–æ–¥–∞—Ä–∫–∏</button>
          <button class="btn" id="bee-addTonBtn">–í–Ω–µ—Å—Ç–∏ TON</button>
          <button class="btn danger" id="bee-withdrawBtn" style="display:none;">–í—ã–≤–µ—Å—Ç–∏ –≥–∏—Ñ—Ç—ã</button>
        </div>
        <div id="bee-players"></div>
        <div id="bee-winner"></div>
      </div>

      <!-- PvP Tab -->
      <div id="pvp" class="tab">
        <div id="info-block-cards"></div>
        <button id="openHistoryBtn" class="history-btn" title="–ò—Å—Ç–æ—Ä–∏—è —Ä–∞—É–Ω–¥–æ–≤">
          <img src="history-icon.svg" alt="" style="width:20px;vertical-align:middle;"/>
        </button>
        <div id="bank">0 –≥–∏—Ñ—Ç–æ–≤ ‚Ä¢ 0 TON</div>
        <canvas id="wheel"></canvas>
        <div id="timer">–°—Ç–∞—Ä—Ç —á–µ—Ä–µ–∑ 00:00</div>
        
        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä -->
        <div style="width: 80%; margin: 10px auto;">
          <div style="height: 6px; background: #2e293d; border-radius: 3px;">
            <div id="progress-fill" style="height: 100%; width: 0%; background: #ba8cff; border-radius: 3px; transition: width 0.5s;"></div>
          </div>
          <div id="waiting-text" style="font-size: 12px; text-align: center; margin-top: 5px;">–û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤... (0/2)</div>
        </div>
        
        <div class="btn-group">
          <button class="btn" id="addGiftsBtn">–í–Ω–µ—Å—Ç–∏ –ü–æ–¥–∞—Ä–æ–∫</button>
          <button class="btn" id="addTonBtn">–í–Ω–µ—Å—Ç–∏ TON</button>
          <button class="btn danger" id="withdrawBtn" style="display:none;">–í—ã–≤–µ—Å—Ç–∏ –≥–∏—Ñ—Ç—ã</button>
        </div>
        <div id="players"></div>
        <div id="winner"></div>
      </div>

      <!-- Inventory Tab -->
      <div id="inventory" class="tab" style="display:none;">
        <h2>–í–∞—à–∏ –≥–∏—Ñ—Ç—ã</h2>
        <div id="empty-inventory-hint" style="display:none; margin-top:32px;">
          <div class="plane-anim" style="margin-bottom:14px;">
            <svg width="60" height="60" viewBox="0 0 48 48" fill="none">
              <polygon points="2,24 46,6 38,42 24,32 10,36" fill="#fff" stroke="#3e8ed0" stroke-width="2"/>
              <polyline points="2,24 24,32 46,6" fill="none" stroke="#3e8ed0" stroke-width="2"/>
            </svg>
          </div>
          <div class="modal-text" style="margin:0; font-size:17px;">
            –ü–æ–¥–∞—Ä–∫–æ–≤ –ø–æ–∫–∞ —á—Ç–æ –Ω–µ—Ç—É....<br>
            –ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫, –æ—Ç–ø—Ä–∞–≤—å –µ–≥–æ –±–æ—Ç—É<br>
            <b>@GIFTBOTRELAYER</b>
          </div>
        </div>
        <div id="inventoryList"></div>
        <button class="btn danger" id="withdrawBtn" style="display:none;">–í—ã–≤–µ—Å—Ç–∏ –≥–∏—Ñ—Ç—ã</button>
      </div>
      

      <!-- Profile Tab -->
      <div id="profile" class="tab" style="display:none;">
        <div class="profile-card" style="position: relative;">
          <img id="profile-avatar" src="https://ui-avatars.com/api/?name=Demo" class="profile-avatar" />
          <div class="profile-info">
            <div id="profile-username">@demo</div>
            <div id="profile-earn">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: <span>0 TON</span></div>
          </div>
          <div class="theme-switcher" style="margin:15px 0;">
  <label class="switch">
    <input type="checkbox" id="theme-toggle" onchange="toggleTheme()">
    <span class="slider"></span>
  </label>
  <span style="margin-left:10px;">–¢—ë–º–Ω–∞—è —Ç–µ–º–∞</span>
</div>
          <div id="ton-connect-button" style="position: absolute; top: 12px; right: 12px;"></div>
        </div>
        <button class="btn" onclick="openReferralModal()" style="margin:15px 0;width:100%;">
    üíé –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–∑–µ–π
  </button>
        <h3>–ò—Å—Ç–æ—Ä–∏—è –ø–æ–±–µ–¥</h3>
        <div id="withdraw-history"></div>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ -->
  <div id="modal-info" class="mini-modal" style="display:none;">
    <div class="mini-modal-content">
      <div id="modal-info-title" class="mini-modal-title"></div>
      <div id="modal-info-user" class="mini-modal-user"></div>
      <div id="modal-info-prize" class="mini-modal-prize"></div>
      <div id="modal-info-amount" class="mini-modal-amount"></div>
      <button class="btn" id="closeModalInfo" style="margin-top:18px;">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏—Å—Ç–æ—Ä–∏–∏ -->
  <div id="history-modal" class="modal-bg" style="display:none;">
    <div class="modal-content">
      <button id="closeHistoryModal" class="close-btn" style="float:right;font-size:24px;">&times;</button>
      <h3 style="margin-top:0;">–ò—Å—Ç–æ—Ä–∏—è —Ä–∞—É–Ω–¥–æ–≤</h3>
      <div id="history-list"></div>
    </div>
  </div>

  <!-- –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
  <div id="tabs-bottom">
    <button class="tab-btn selected" onclick="showTab('pvp')" id="tab-pvp">PvP</button>
    <button class="tab-btn" onclick="showTab('bee')" id="tab-bee">–ü—á–µ–ª–∞</button>
    <button class="tab-btn" onclick="showTab('inventory')" id="tab-inventory">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
    <button class="tab-btn" onclick="showTab('profile')" id="tab-profile">–ü—Ä–æ—Ñ–∏–ª—å</button>
  </div>

  <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ -->
  <script src="https://unpkg.com/@tonconnect/ui/dist/tonconnect-ui.min.js"></script>
  <script src="app.js"></script>
  
  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
    window.Telegram.WebApp.ready();
    const tg = window.Telegram.WebApp;
    
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    let TG_USER_ID = 1;
    let TG_USERNAME = "demo";
    let TG_AVATAR = "";
    
    // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
    if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
      const tgUser = tg.initDataUnsafe.user;
      TG_USER_ID = tgUser.id;
      TG_USERNAME = tgUser.username || tgUser.first_name || `id${TG_USER_ID}`;
      TG_AVATAR = tgUser.photo_url || "";
      
      // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
      document.getElementById('tg-user-bar').style.display = 'block';
      document.getElementById('tg-user-bar').innerHTML = `
        <div style="display:flex;align-items:center;">
          <img src="${TG_AVATAR}" style="width:36px;height:36px;border-radius:50%;margin-right:12px;">
          <span style="font-size:16px;font-weight:600;">@${TG_USERNAME}</span>
          <span style="font-size:12px;font-weight:400;margin-left:12px;opacity:0.7;">id:${TG_USER_ID}</span>
        </div>
      `;
      
      // –û—Ç–ø—Ä–∞–≤–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
      if (TG_AVATAR) {
        fetch(`/api/update_avatar`, {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({user_id: TG_USER_ID, avatar: TG_AVATAR})
        }).catch(() => {});
      }
    }
    
    // –°–¥–µ–ª–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º –¥–ª—è app.js
    window.TG_USER_ID = TG_USER_ID;
    window.TG_USERNAME = TG_USERNAME;
    window.TG_AVATAR = TG_AVATAR;
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
    document.addEventListener('DOMContentLoaded', function() {
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º PvP –≤–∫–ª–∞–¥–∫—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
      showTab('pvp');
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TON Connect
      if (typeof TON_CONNECT_UI !== 'undefined') {
        window.tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
          manifestUrl: 'https://paypal.net.ru/tonconnect-manifest.json',
          buttonRootId: 'ton-connect-button'
        });
      }
    });
  </script>
</body>
</html>